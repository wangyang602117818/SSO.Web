/*! 2018-05-30 04:26:08 */
!function(C){function n(e,t,s){return t<e&&e<t+s}C.widget("mjs.nestedSortable",C.extend({},C.ui.sortable.prototype,{options:{doNotClear:!1,expandOnHover:700,isAllowed:function(e,t,s){return!0},isTree:!1,listType:"ol",maxLevels:0,protectRoot:!1,rootID:null,rtl:!1,startCollapsed:!1,tabSize:20,branchClass:"mjs-nestedSortable-branch",collapsedClass:"mjs-nestedSortable-collapsed",disableNestingClass:"mjs-nestedSortable-no-nesting",errorClass:"mjs-nestedSortable-error",expandedClass:"mjs-nestedSortable-expanded",hoveringClass:"mjs-nestedSortable-hovering",leafClass:"mjs-nestedSortable-leaf",disabledClass:"mjs-nestedSortable-disabled"},_create:function(){if(this.element.data("ui-sortable",this.element.data("mjs-nestedSortable")),!this.element.is(this.options.listType))throw new Error("nestedSortable: Please check that the listType option is set to your actual list type");if(this.options.isTree&&this.options.expandOnHover&&(this.options.tolerance="intersect"),C.ui.sortable.prototype._create.apply(this,arguments),this.options.isTree){var t=this;C(this.items).each(function(){var e=this.item;e.children(t.options.listType).length?(e.addClass(t.options.branchClass),e.hasClass(t.options.collapsedClass)||e.hasClass(t.options.expandedClass)||(t.options.startCollapsed?e.addClass(t.options.collapsedClass):e.addClass(t.options.expandedClass))):e.addClass(t.options.leafClass)})}},_destroy:function(){return this.element.removeData("mjs-nestedSortable").removeData("ui-sortable"),C.ui.sortable.prototype._destroy.apply(this,arguments)},_mouseDrag:function(e){var t,s,i,o,l=this.options,r=!1;this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<l.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+l.scrollSpeed:e.pageY-this.overflowOffset.top<l.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-l.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<l.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+l.scrollSpeed:e.pageX-this.overflowOffset.left<l.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-l.scrollSpeed)):(e.pageY-C(document).scrollTop()<l.scrollSensitivity?r=C(document).scrollTop(C(document).scrollTop()-l.scrollSpeed):C(window).height()-(e.pageY-C(document).scrollTop())<l.scrollSensitivity&&(r=C(document).scrollTop(C(document).scrollTop()+l.scrollSpeed)),e.pageX-C(document).scrollLeft()<l.scrollSensitivity?r=C(document).scrollLeft(C(document).scrollLeft()-l.scrollSpeed):C(window).width()-(e.pageX-C(document).scrollLeft())<l.scrollSensitivity&&(r=C(document).scrollLeft(C(document).scrollLeft()+l.scrollSpeed))),!1!==r&&C.ui.ddmanager&&!l.dropBehaviour&&C.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute");var n=this.placeholder.offset().top;this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),this.hovering=this.hovering?this.hovering:null,this.mouseentered=!!this.mouseentered&&this.mouseentered;var a=this.placeholder[0].parentNode.parentNode&&C(this.placeholder[0].parentNode.parentNode).closest(".ui-sortable").length?C(this.placeholder[0].parentNode.parentNode):null,h=this._getLevel(this.placeholder),p=this._getChildLevels(this.helper),d=document.createElement(l.listType);for(t=this.items.length-1;0<=t;t--)if(s=this.items[t],i=s.item[0],(o=this._intersectsWithPointer(s))&&s.instance===this.currentContainer){if(-1!==i.className.indexOf(l.disabledClass))if(2===o){var c=this.items[t+1];if(c&&-1!==c.item[0].className.indexOf(l.disabledClass))continue}else if(1===o){var u=this.items[t-1];if(u&&-1!==u.item[0].className.indexOf(l.disabledClass))continue}if(!(i===this.currentItem[0]||this.placeholder[1===o?"next":"prev"]()[0]===i||C.contains(this.placeholder[0],i)||"semi-dynamic"===this.options.type&&C.contains(this.element[0],i))){if(this.mouseentered||(C(i).mouseenter(),this.mouseentered=!0),l.isTree&&C(i).hasClass(l.collapsedClass)&&l.expandOnHover&&!this.hovering){C(i).addClass(l.hoveringClass);var m=this;this.hovering=window.setTimeout(function(){C(i).removeClass(l.collapsedClass).addClass(l.expandedClass),m.refreshPositions(),m._trigger("expand",e,m._uiHash())},l.expandOnHover)}if(this.direction=1==o?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(s))break;if(C(i).mouseleave(),this.mouseentered=!1,C(i).removeClass(l.hoveringClass),this.hovering&&window.clearTimeout(this.hovering),this.hovering=null,!l.protectRoot||this.currentItem[0].parentNode==this.element[0]&&i.parentNode!=this.element[0])l.protectRoot||this._rearrange(e,s);else if(this.currentItem[0].parentNode!=this.element[0]&&i.parentNode==this.element[0]){C(i).children(l.listType).length||(i.appendChild(d),l.isTree&&C(i).removeClass(l.leafClass).addClass(l.branchClass+" "+l.expandedClass));var f="down"===this.direction?C(i).prev().children(l.listType):C(i).children(l.listType);void 0!==f[0]&&this._rearrange(e,null,f)}else this._rearrange(e,s);this._clearEmpty(i),this._trigger("change",e,this._uiHash());break}}var v=this.placeholder[0].previousSibling?C(this.placeholder[0].previousSibling):null;if(null!=v)for(;"li"!=v[0].nodeName.toLowerCase()||-1!==v[0].className.indexOf(l.disabledClass)||v[0]==this.currentItem[0]||v[0]==this.helper[0];){if(!v[0].previousSibling){v=null;break}v=C(v[0].previousSibling)}var g=this.placeholder[0].nextSibling?C(this.placeholder[0].nextSibling):null;if(null!=g)for(;"li"!=g[0].nodeName.toLowerCase()||-1!==g[0].className.indexOf(l.disabledClass)||g[0]==this.currentItem[0]||g[0]==this.helper[0];){if(!g[0].nextSibling){g=null;break}g=C(g[0].nextSibling)}return this.beyondMaxLevels=0,null==a||null!=g||l.protectRoot&&a[0].parentNode==this.element[0]||!(l.rtl&&this.positionAbs.left+this.helper.outerWidth()>a.offset().left+a.outerWidth()||!l.rtl&&this.positionAbs.left<a.offset().left)?null==v||v.hasClass(l.disableNestingClass)||!(v.children(l.listType).length&&v.children(l.listType).is(":visible")||!v.children(l.listType).length)||l.protectRoot&&this.currentItem[0].parentNode==this.element[0]||!(l.rtl&&this.positionAbs.left+this.helper.outerWidth()<v.offset().left+v.outerWidth()-l.tabSize||!l.rtl&&this.positionAbs.left>v.offset().left+l.tabSize)?this._isAllowed(a,h,h+p):(this._isAllowed(v,h,h+p+1),v.children(l.listType).length||(v[0].appendChild(d),l.isTree&&v.removeClass(l.leafClass).addClass(l.branchClass+" "+l.expandedClass)),n&&n<=v.offset().top?v.children(l.listType).prepend(this.placeholder):v.children(l.listType)[0].appendChild(this.placeholder[0]),this._trigger("change",e,this._uiHash())):(a.after(this.placeholder[0]),l.isTree&&a.children(l.listItem).children("li:visible:not(.ui-sortable-helper)").length<1&&a.removeClass(this.options.branchClass+" "+this.options.expandedClass).addClass(this.options.leafClass),this._clearEmpty(a[0]),this._trigger("change",e,this._uiHash())),this._contactContainers(e),C.ui.ddmanager&&C.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,t){this.beyondMaxLevels&&(this.placeholder.removeClass(this.options.errorClass),this.domPosition.prev?C(this.domPosition.prev).after(this.placeholder):C(this.domPosition.parent).prepend(this.placeholder),this._trigger("revert",e,this._uiHash())),C("."+this.options.hoveringClass).mouseleave().removeClass(this.options.hoveringClass),this.mouseentered=!1,this.hovering&&window.clearTimeout(this.hovering),this.hovering=null,C.ui.sortable.prototype._mouseStop.apply(this,arguments);var s=C(this.domPosition.parent).parent().attr("id"),i=this.domPosition.prev?C(this.domPosition.prev).next().index():0;s==this._uiHash().item.parent().parent().attr("id")&&i==this._uiHash().item.index()||this._trigger("relocate",e,this._uiHash())},_intersectsWithSides:function(e){var t=this.options.isTree?.8:.5,s=n(this.positionAbs.top+this.offset.click.top,e.top+e.height*t,e.height),i=n(this.positionAbs.top+this.offset.click.top,e.top-e.height*t,e.height),o=n(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),l=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"==r&&o||"left"==r&&!o:l&&("down"==l&&s||"up"==l&&i)},_contactContainers:function(e){this.options.protectRoot&&this.currentItem[0].parentNode==this.element[0]||C.ui.sortable.prototype._contactContainers.apply(this,arguments)},_clear:function(e,t){C.ui.sortable.prototype._clear.apply(this,arguments);for(var s=this.items.length-1;0<=s;s--){var i=this.items[s].item[0];this._clearEmpty(i)}},serialize:function(e){var s=C.extend({},this.options,e),t=this._getItemsAsjQuery(s&&s.connected),i=[];return C(t).each(function(){var e=(C(s.item||this).attr(s.attribute||"id")||"").match(s.expression||/(.+)[-=_](.+)/),t=(C(s.item||this).parent(s.listType).parent(s.items).attr(s.attribute||"id")||"").match(s.expression||/(.+)[-=_](.+)/);e&&i.push((s.key||e[1])+"["+(s.key&&s.expression?e[1]:e[2])+"]="+(t?s.key&&s.expression?t[1]:t[2]:s.rootID))}),!i.length&&s.key&&i.push(s.key+"="),i.join("&")},toHierarchy:function(e){var o=C.extend({},this.options,e),t=(o.startDepthCount,[]);return C(this.element).children(o.items).each(function(){var e=function t(e){var s=(C(e).attr(o.attribute||"id")||"").match(o.expression||/(.+)[-=_](.+)/);if(s){var i={id:s[2]};return 0<C(e).children(o.listType).children(o.items).length&&(i.children=[],C(e).children(o.listType).children(o.items).each(function(){var e=t(this);i.children.push(e)})),i}}(this);t.push(e)}),t},toArray:function(e){var a=C.extend({},this.options,e),h=a.startDepthCount||0,p=[],t=1;return a.excludeRoot||(p.push({item_id:a.rootID,parent_id:null,depth:h,left:t,right:2*(C(a.items,this.element).length+1)}),t++),C(this.element).children(a.items).each(function(){t=function e(t,s,i){var o,l,r=i+1;0<C(t).children(a.listType).children(a.items).length&&(s++,C(t).children(a.listType).children(a.items).each(function(){r=e(C(this),s,r)}),s--);o=C(t).attr(a.attribute||"id").match(a.expression||/(.+)[-=_](.+)/);if(s===h+1)l=a.rootID;else{var n=C(t).parent(a.listType).parent(a.items).attr(a.attribute||"id").match(a.expression||/(.+)[-=_](.+)/);l=n[2]}o&&p.push({item_id:o[2],parent_id:l,depth:s,left:i,right:r});i=r+1;return i}(this,h+1,t)}),p=p.sort(function(e,t){return e.left-t.left})},_clearEmpty:function(e){var t=this.options,s=C(e).children(t.listType);!s.length||s.children().length||t.doNotClear?t.isTree&&s.length&&s.children().length&&s.is(":visible")?C(e).removeClass(t.leafClass).addClass(t.branchClass+" "+t.expandedClass):t.isTree&&s.length&&s.children().length&&!s.is(":visible")&&C(e).removeClass(t.leafClass).addClass(t.branchClass+" "+t.collapsedClass):(t.isTree&&C(e).removeClass(t.branchClass+" "+t.expandedClass).addClass(t.leafClass),s.remove())},_getLevel:function(e){var t=1;if(this.options.listType)for(var s=e.closest(this.options.listType);s&&0<s.length&&!s.is(".ui-sortable");)t++,s=s.parent().closest(this.options.listType);return t},_getChildLevels:function(e,s){var i=this,t=this.options,o=0;return s=s||0,C(e).children(t.listType).children(t.items).each(function(e,t){o=Math.max(i._getChildLevels(t,s+1),o)}),s?o+1:o},_isAllowed:function(e,t,s){var i=this.options,o=this.placeholder.closest(".ui-sortable").nestedSortable("option","maxLevels");i.isAllowed(this.placeholder,e,this.currentItem)?o<s&&0!=o?(this.placeholder.addClass(i.errorClass),this.beyondMaxLevels=s-o):(this.placeholder.removeClass(i.errorClass),this.beyondMaxLevels=0):(this.placeholder.addClass(i.errorClass),this.beyondMaxLevels=o<s&&0!=o?s-o:1)}})),C.mjs.nestedSortable.prototype.options=C.extend({},C.ui.sortable.prototype.options,C.mjs.nestedSortable.prototype.options)}(jQuery);